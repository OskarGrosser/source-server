<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Info-Bar for Streaming</title>

    <script type="module">
const time = document.getElementById("time");
const items = document.getElementById("items");

const reconnect = () => { itemConnection(null, reconnect); };
itemConnection(null, reconnect);

function itemConnection(onOpen, onClose) {
  const socket = new WebSocket("ws://localhost:8080/info");
  socket.addEventListener("open", () => {
    console.log("Connection established");
    onOpen?.();
  });
  socket.addEventListener("close", () => {
    console.log("Connection lost");
    onClose?.();
  });

  socket.addEventListener("message", evt => {
    updateInfo(JSON.parse(evt.data));
  });
}

function updateInfo(data) {
  if (data.datetime) {
    time.textContent = time.datetime = data.datetime;
  }

  if (data.items) {
    const fragment = document.createDocumentFragment();
    for (const group of data.items) {
      const div = document.createElement("div");
      for (const item of group) {
        const span = document.createElement("span");
        span.textContent = item;
        div.append(span);
      }
      fragment.append(div);
    }
    items.replaceChildren(fragment);
  }
}
    </script>
    <style>
html {
  height: 100%;
}
body {
  margin: 0;
  min-height: 100%;
  display: grid;
  grid-template-columns: auto 1fr auto;
  color: lightgray;
  font-family: "Open Sans", Arial, sans-serif;
  background-color: #445;
}

div {
  padding-inline: .5rem;
  display: flex;
  align-items: center;
  white-space: nowrap;
  overflow: hidden;
}

div:has(#time) {
  border-inline-end: 2px solid lightgray;
  background-color: #556;
  font-family: "Roboto Mono", monospace;
}
    </style>
  </head>
  <body>
    <div><span id="time"></span></div>
    <div id="items"></div>
  </body>
</html>
